<!-- ban-list.component.html -->

<!-- Header -->
<div class="d-flex align-items-center justify-content-between gap-3 mb-3">
  <div>
    <h2 class="h5 mb-0">Ban List</h2>
    <div class="text-muted small">View banned cards as a list or as images.</div>
  </div>

  <div class="btn-group btn-group-sm">
    <button
      class="btn btn-outline-secondary"
      [class.active]="viewMode === 'list'"
      (click)="viewMode = 'list'"
    >
      List
    </button>
    <button
      class="btn btn-outline-secondary"
      [class.active]="viewMode === 'image'"
      (click)="viewMode = 'image'"
    >
      Cards
    </button>
  </div>
</div>

<!-- States -->
<div *ngIf="loading" class="text-muted">Loading‚Ä¶</div>
<div *ngIf="error" class="alert alert-danger">{{ error }}</div>

<div *ngIf="!loading && !error && bannedCards.length === 0" class="alert alert-info">
  No banned cards.
</div>

<!-- Two-pane layout -->
<div *ngIf="!loading && !error && bannedCards.length > 0" class="row g-3">

  <!-- LEFT -->
  <div class="col-12 col-lg-8">
    <div class="panel h-100">
      <div class="panel-head d-flex align-items-center justify-content-between gap-2">
        <div class="panel-title">Banned Cards</div>
        <div class="panel-sub">{{ bannedCards.length }} total</div>
      </div>

      <div class="panel-body">

        <!-- List view -->
        <div *ngIf="viewMode === 'list'" class="list-group ban-list">
          <button
            type="button"
            class="list-group-item list-group-item-action"
            *ngFor="let c of bannedCards"
            (click)="select(c)"
            [class.active]="isSelected(c.cardId)"
            [ngStyle]="getRowStyleForCard(c)"
          >
            <div class="d-flex justify-content-between align-items-start gap-2">
              <div class="min-w-0">
                <div class="fw-semibold text-truncate">
                  {{ c.name ?? ('Card #' + c.cardId) }}
                </div>
                <div class="text-muted small text-truncate">
                  #{{ c.cardId }} ¬∑ {{ c.humanReadableCardType ?? c.cardType ?? '' }}
                </div>
              </div>

              <span class="badge text-bg-danger flex-shrink-0">BANNED</span>
            </div>
          </button>
        </div>

        <!-- Image grid view -->
        <div *ngIf="viewMode === 'image'" class="row g-2">
          <div class="col-6 col-sm-4 col-md-3 col-lg-2" *ngFor="let c of bannedCards">

            <div
              class="ban-tile"
              (click)="select(c)"
              [class.is-selected]="isSelected(c.cardId)"
              title="Select"
            >
              <img
                *ngIf="c.imageUrl"
                [src]="c.imageUrl"
                class="w-100 d-block"
                alt="card"
                style="aspect-ratio: 3 / 4; object-fit: contain;"
              />

              <div *ngIf="!c.imageUrl" class="ban-tile-empty text-muted">
                No image
              </div>

              <img
                *ngIf="c.banned"
                src="assets/icons/banned.svg"
                alt="Banned"
                class="position-absolute top-0 end-0 mx-2 my-1 banned-icon"
              />
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="col-12 col-lg-4">
    <div class="panel h-100" *ngIf="selected; else noSelection">
      <div class="panel-head">
        <div class="panel-title">Details</div>
        <div class="panel-sub">Selected card</div>
      </div>

      <div class="panel-body d-flex flex-column">

        <!-- Image -->
        <div class="text-center mb-3">
          <img
            *ngIf="selected.imageUrl"
            [src]="selected.imageUrl"
            class="img-fluid rounded border"
            alt="card image"
            style="max-height: 420px;"
          />
          <div *ngIf="!selected.imageUrl" class="text-muted">No image.</div>
        </div>

        <!-- Name / Type -->
        <div class="mb-2">
          <div class="fw-semibold">
            {{ selected.name ?? ('Card #' + selected.cardId) }}
          </div>

          <div class="text-muted small">
            {{ selected.humanReadableCardType ?? selected.cardType ?? '' }}
          </div>

          <div class="text-muted small" *ngIf="selected.archetype">
            {{ selected.archetype }}
          </div>
        </div>

        <!-- Meta -->
        <div class="mb-2 small text-muted">
          <div>ID: {{ selected.cardId }}</div>
          <div>
            Status:
            <span class="badge text-bg-danger ms-1">BANNED</span>
          </div>
        </div>

        <!-- Description -->
        <div class="ban-desc mb-3">
          {{ selected.description ?? 'No description.' }}
        </div>

        <!-- Stats -->
        <div
          *ngIf="selected.atk != null || selected.def != null || selected.level != null"
          class="d-flex justify-content-between align-items-center small text-muted border-top pt-2 mt-2 pb-2"
        >
          <div *ngIf="selected.level != null">
            ‚≠ê Level: <strong>{{ selected.level }}</strong>
          </div>
          <div *ngIf="selected.atk != null">
            ‚öîÔ∏è ATK: <strong>{{ selected.atk }}</strong>
          </div>
          <div *ngIf="selected.def != null">
            üõ°Ô∏è DEF: <strong>{{ selected.def }}</strong>
          </div>
        </div>

        <!-- Reserved actions space -->
        <div class="d-grid gap-2 mt-auto"></div>
      </div>
    </div>

    <ng-template #noSelection>
      <div class="alert alert-secondary">
        Select a card to see details.
      </div>
    </ng-template>
  </div>

</div>
